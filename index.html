<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat App - Modern Messaging</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="css/style.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
    }

    :root {
      --primary: #7c3aed;
      --primary-dark: #6d28d9;
      --primary-light: #8b5cf6;
      --secondary: #f8fafc;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --bg-light: #ffffff;
      --bg-dark: #0f172a;
      --border-light: #e2e8f0;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
        0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --radius: 12px;
    }

    .dark-mode {
      --primary: #8b5cf6;
      --primary-dark: #7c3aed;
      --primary-light: #a78bfa;
      --secondary: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --bg-light: #0f172a;
      --bg-dark: #020617;
      --border-light: #334155;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--text-primary);
      transition: all 0.3s ease;
      min-height: 100vh;
      overflow-x: hidden;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    /* Main Container */
    .main-container {
      display: flex;
      height: 100vh;
      max-width: 1400px;
      margin: 0 auto;
      overflow: hidden;
    }

    /* Fixed Sidebar */
    .contacts-sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 380px;
      background: var(--bg-light);
      border-right: 1px solid var(--border-light);
      z-index: 50;
      overflow-y: auto;
      transition: all 0.3s ease;
      transform: translateX(0);
    }

    .dark-mode .contacts-sidebar {
      background: var(--bg-light);
      border-right-color: var(--border-light);
    }

    /* Chat Container */
    .chat-container {
      flex: 1;
      margin-left: 380px;
      background: var(--bg-light);
      display: flex;
      flex-direction: column;
      height: 100vh;
      transition: all 0.3s ease;
    }

    .dark-mode .chat-container {
      background: var(--bg-light);
    }

    /* Message Styles */
    .incoming-message {
      background: var(--secondary);
      color: var(--text-primary);
      border-radius: 18px 18px 18px 4px;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .outgoing-message {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border-radius: 18px 18px 4px 18px;
      box-shadow: 0 2px 8px rgba(124, 58, 237, 0.2);
    }

    .dark-mode .incoming-message {
      background: rgba(30, 41, 59, 0.7);
    }

    /* User Selection Animation */
    .user-selection {
      animation: selectUser 0.3s ease-out;
    }

    @keyframes selectUser {
      0% {
        transform: translateX(-10px);
        opacity: 0;
      }

      100% {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Message Animation */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message {
      animation: slideIn 0.3s ease-out;
    }

    /* Typing Animation */
    .typing-indicator div div {
      animation: bounce 1.5s infinite ease-in-out;
    }

    @keyframes bounce {

      0%,
      60%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-5px);
      }
    }

    /* Mobile Sidebar Animation */
    @keyframes slideInLeft {
      from {
        transform: translateX(-100%);
      }

      to {
        transform: translateX(0);
      }
    }

    @keyframes slideOutLeft {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-100%);
      }
    }

    /* Active User Highlight */
    .active-user {
      background: linear-gradient(135deg,
          var(--primary),
          var(--primary-dark)) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.2);
    }

    .active-user .text-gray-500 {
      color: rgba(255, 255, 255, 0.9) !important;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-light);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }

    /* Overlay */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 40;
      display: none;
      backdrop-filter: blur(4px);
    }

    .overlay.active {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    /* Theme Toggle */
    .theme-toggle {
      position: relative;
      width: 50px;
      height: 26px;
    }

    .theme-toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .theme-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--border-light);
      border-radius: 34px;
      transition: 0.4s;
    }

    .theme-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background: white;
      border-radius: 50%;
      transition: 0.4s;
    }

    input:checked+.theme-slider {
      background: var(--primary);
    }

    input:checked+.theme-slider:before {
      transform: translateX(24px);
    }

    /* Video Player */
    .video-container {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      background: #000;
      max-width: 280px;
    }

    .video-player {
      width: 100%;
      height: auto;
    }

    /* Status Indicators */
    .status-online {
      width: 10px;
      height: 10px;
      background: var(--success);
      border-radius: 50%;
      border: 2px solid var(--bg-light);
      position: absolute;
      bottom: 0;
      right: 0;
    }

    .dark-mode .status-online {
      border-color: var(--bg-light);
    }

    .status-offline {
      width: 10px;
      height: 10px;
      background: var(--text-secondary);
      border-radius: 50%;
      border: 2px solid var(--bg-light);
      position: absolute;
      bottom: 0;
      right: 0;
    }

    .dark-mode .status-offline {
      border-color: var(--bg-light);
    }

    .status-away {
      width: 10px;
      height: 10px;
      background: var(--warning);
      border-radius: 50%;
      border: 2px solid var(--bg-light);
      position: absolute;
      bottom: 0;
      right: 0;
    }

    .dark-mode .status-away {
      border-color: var(--bg-light);
    }

    /* Menu Dropdown */
    .menu-dropdown {
      animation: dropdown 0.2s ease-out;
    }

    @keyframes dropdown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .contacts-sidebar {
        position: fixed;
        width: 85%;
        max-width: 320px;
        transform: translateX(-100%);
        z-index: 100;
      }

      .contacts-sidebar.mobile-active {
        transform: translateX(0);
        animation: slideInLeft 0.3s forwards;
      }

      .chat-container {
        margin-left: 0;
        width: 100%;
      }

      .message-input input {
        font-size: 16px;
        /* Prevents zoom on iOS */
      }

      .video-container {
        max-width: 100%;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .contacts-sidebar {
        width: 320px;
      }

      .chat-container {
        margin-left: 320px;
      }
    }

    /* Enhancements */
    .avatar {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      background: linear-gradient(135deg, var(--primary-light), var(--primary));
      color: white;
    }

    .avatar-small {
      width: 32px;
      height: 32px;
      font-size: 14px;
    }

    .avatar-medium {
      width: 48px;
      height: 48px;
      font-size: 18px;
    }

    .avatar-large {
      width: 56px;
      height: 56px;
      font-size: 22px;
    }

    .message-time {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 4px;
    }

    .unread-badge {
      background: var(--danger);
      color: white;
      font-size: 11px;
      font-weight: 600;
      min-width: 20px;
      height: 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .message-status {
      font-size: 10px;
      margin-left: 4px;
    }

    .date-divider {
      position: relative;
      text-align: center;
      margin: 20px 0;
    }

    .date-divider span {
      background: var(--secondary);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .dark-mode .date-divider span {
      background: rgba(30, 41, 59, 0.7);
    }

    /* Loading Animation */
    .loading-dots {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .loading-dots div {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--primary);
      animation: loading 1.4s infinite ease-in-out;
    }

    .loading-dots div:nth-child(2) {
      animation-delay: 0.2s;
    }

    .loading-dots div:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes loading {

      0%,
      80%,
      100% {
        transform: scale(0.8);
        opacity: 0.5;
      }

      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Fix for dark mode text colors */
    .dark-mode .text-gray-500 {
      color: #9ca3af !important;
    }

    .dark-mode .text-gray-400 {
      color: #6b7280 !important;
    }

    .dark-mode .text-gray-300 {
      color: #4b5563 !important;
    }

    .dark-mode .bg-gray-100 {
      background-color: #1f2937 !important;
    }

    .dark-mode .bg-gray-800 {
      background-color: #111827 !important;
    }

    .dark-mode .border-gray-200 {
      border-color: #374151 !important;
    }

    .dark-mode .border-gray-700 {
      border-color: #4b5563 !important;
    }

    .dark-mode .hover\:bg-gray-100:hover {
      background-color: #374151 !important;
    }

    .dark-mode .hover\:bg-gray-800:hover {
      background-color: #1f2937 !important;
    }
  </style>
</head>

<body>
  <!-- Overlay for mobile sidebar -->
  <div id="overlay" class="overlay" onclick="closeSidebar()"></div>

  <!-- Theme Toggle -->
  <div class="fixed top-4 right-4 z-50 flex items-center gap-2">
    <i class="fas fa-sun text-yellow-500" id="sun-icon"></i>
    <label class="theme-toggle">
      <input type="checkbox" id="themeToggle">
      <span class="theme-slider"></span>
    </label>
    <i class="fas fa-moon text-indigo-400" id="moon-icon"></i>
  </div>

  <div class="main-container">
    <!-- Contacts Sidebar -->
    <div id="contacts-sidebar" class="contacts-sidebar flex flex-col">
      <!-- Sidebar Header -->
      <div class="p-4 md:p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
              Messages
            </h1>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">7 unread messages</p>
          </div>
          <button class="text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-white transition-colors"
            onclick="newChat()">
            <i class="fas fa-edit text-xl"></i>
          </button>
        </div>

        <!-- Search Bar -->
        <div class="mt-6 relative">
          <input type="text" placeholder="Search conversations..."
            class="w-full pl-12 pr-4 py-3 bg-gray-100 dark:bg-gray-800 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary dark:text-white transition-all"
            id="searchContacts">
          <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          <button class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-primary">
            <i class="fas fa-sliders-h"></i>
          </button>
        </div>
      </div>

      <!-- Contacts List -->
      <div class="flex-1 overflow-y-auto p-2" id="contacts-list">
        <!-- Contacts will be loaded here dynamically -->
      </div>

      <!-- User Profile -->
      <div class="p-4 border-t border-gray-200 dark:border-gray-700">
        <div class="flex items-center gap-3">
          <div class="avatar avatar-medium rounded-full relative">
            ME
            <div class="status-online"></div>
          </div>
          <div class="flex-1">
            <h3 class="font-semibold">Myself</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">Online</p>
          </div>
          <button class="text-gray-500 hover:text-primary dark:text-gray-400" onclick="showSettings()">
            <i class="fas fa-cog text-xl"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Chat Container -->
    <div id="chat-container" class="chat-container">
      <!-- Chat Header -->
      <div
        class="chat-header bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 md:p-6 flex items-center justify-between">
        <div class="flex items-center">
          <button onclick="toggleSidebar()" class="mr-4 md:hidden text-white">
            <i class="fas fa-bars text-xl"></i>
          </button>
          <button onclick="backToContacts()" class="mr-4 hidden md:block text-white opacity-80 hover:opacity-100">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="avatar avatar-medium rounded-full mr-4 relative">
            <span id="current-user-avatar">JD</span>
            <div class="status-online"></div>
          </div>
          <div>
            <h2 id="current-user-name" class="font-bold text-lg">John Doe</h2>
            <p id="current-user-status" class="text-sm opacity-90">Online</p>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <button class="text-white opacity-80 hover:opacity-100 transition-opacity" onclick="startCall()">
            <i class="fas fa-phone text-xl"></i>
          </button>
          <button class="text-white opacity-80 hover:opacity-100 transition-opacity" onclick="startVideoCall()">
            <i class="fas fa-video text-xl"></i>
          </button>
          <div class="relative">
            <button class="text-white opacity-80 hover:opacity-100 transition-opacity" onclick="toggleMenu()">
              <i class="fas fa-ellipsis-vertical text-xl"></i>
            </button>
            <div id="menu-dropdown"
              class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-lg z-40 hidden">
              <div class="p-2">
                <button onclick="viewProfile()"
                  class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3">
                  <i class="fas fa-user text-gray-500"></i>
                  <span>View Profile</span>
                </button>
                <button onclick="muteNotifications()"
                  class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3">
                  <i class="fas fa-bell-slash text-gray-500"></i>
                  <span>Mute</span>
                </button>
                <button onclick="clearChat()"
                  class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3">
                  <i class="fas fa-trash text-gray-500"></i>
                  <span>Clear Chat</span>
                </button>
                <div class="border-t dark:border-gray-700 my-2"></div>
                <button onclick="exportChat()"
                  class="w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3">
                  <i class="fas fa-download text-gray-500"></i>
                  <span>Export Chat</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Messages -->
      <div id="chat-messages" class="flex-1 overflow-y-auto p-4 md:p-6">
        <!-- Messages will be loaded here dynamically -->
        <div class="flex flex-col items-center justify-center h-full text-gray-500" id="no-chat-selected">
          <div
            class="w-24 h-24 rounded-full bg-gradient-to-r from-purple-100 to-indigo-100 dark:from-purple-900/20 dark:to-indigo-900/20 flex items-center justify-center mb-6">
            <i class="fas fa-comments text-4xl text-purple-500"></i>
          </div>
          <h3 class="text-xl font-semibold mb-2">Select a conversation</h3>
          <p class="text-center text-gray-400 dark:text-gray-500">Choose a contact to start messaging</p>
        </div>
      </div>

      <!-- Message Input -->
      <div class="message-input p-4 border-t border-gray-200 dark:border-gray-700">
        <div class="flex items-center gap-2">
          <button
            class="text-gray-500 hover:text-primary dark:text-gray-400 p-3 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
            <i class="fas fa-plus text-xl"></i>
          </button>
          <div class="flex-1">
            <input type="text" id="message-input" placeholder="Type a message..."
              class="w-full px-6 py-4 bg-gray-100 dark:bg-gray-800 rounded-full focus:outline-none focus:ring-2 focus:ring-primary dark:text-white transition-all"
              disabled>
          </div>
          <button
            class="text-white bg-gradient-to-r from-purple-600 to-indigo-600 p-3 rounded-full hover:opacity-90 transition-opacity shadow-lg"
            onclick="sendMessage()" id="send-button" disabled>
            <i class="fas fa-paper-plane text-xl"></i>
          </button>
        </div>
        <div class="flex items-center justify-between mt-3 px-2">
          <div class="flex items-center gap-4 text-gray-500 dark:text-gray-400 text-sm">
            <button class="hover:text-primary transition-colors">
              <i class="fas fa-image"></i>
            </button>
            <button class="hover:text-primary transition-colors">
              <i class="fas fa-camera"></i>
            </button>
            <button class="hover:text-primary transition-colors">
              <i class="fas fa-microphone"></i>
            </button>
          </div>
          <div class="text-xs text-gray-500 dark:text-gray-400">
            Press <kbd class="px-2 py-1 bg-gray-200 dark:bg-gray-700 rounded">Enter</kbd> to send
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/script.js">
    // Initial Data
    const users = [
      {
        id: 1,
        name: "John Doe",
        avatar: "JD",
        status: "online",
        lastSeen: "10:35 AM",
        lastMessage: "Check out this cool photo I took!",
        unread: 0,
        color: "bg-gradient-to-r from-indigo-500 to-purple-500",
      },
      {
        id: 2,
        name: "Alice Smith",
        avatar: "AS",
        status: "online",
        lastSeen: "9:20 AM",
        lastMessage: "Can we meet tomorrow?",
        unread: 3,
        color: "bg-gradient-to-r from-pink-500 to-rose-500",
      },
      {
        id: 3,
        name: "Mike Johnson",
        avatar: "MJ",
        status: "away",
        lastSeen: "Yesterday",
        lastMessage: "I sent you the files",
        unread: 0,
        color: "bg-gradient-to-r from-emerald-500 to-teal-500",
      },
      {
        id: 4,
        name: "Sarah Brown",
        avatar: "SB",
        status: "offline",
        lastSeen: "2 hours ago",
        lastMessage: "Thanks for your help!",
        unread: 1,
        color: "bg-gradient-to-r from-amber-500 to-orange-500",
      },
      {
        id: 5,
        name: "Team Work",
        avatar: "TW",
        status: "online",
        lastSeen: "Mon",
        lastMessage: "Meeting at 3 PM",
        unread: 5,
        color: "bg-gradient-to-r from-blue-500 to-cyan-500",
      },
      {
        id: 6,
        name: "David Wilson",
        avatar: "DW",
        status: "online",
        lastSeen: "Just now",
        lastMessage: "Let's catch up soon",
        unread: 0,
        color: "bg-gradient-to-r from-violet-500 to-purple-500",
      },
      {
        id: 7,
        name: "Emma Davis",
        avatar: "ED",
        status: "away",
        lastSeen: "30 min ago",
        lastMessage: "Are you free for a call?",
        unread: 2,
        color: "bg-gradient-to-r from-rose-500 to-pink-500",
      },
      {
        id: 8,
        name: "Robert Garcia",
        avatar: "RG",
        status: "offline",
        lastSeen: "5 hours ago",
        lastMessage: "See you tomorrow!",
        unread: 0,
        color: "bg-gradient-to-r from-sky-500 to-blue-500",
      },
    ];

    // Chat Messages Data
    const chatMessages = {
      1: [
        {
          id: 1,
          text: "Hey there! How are you doing?",
          incoming: true,
          time: "10:30 AM",
          type: "text",
        },
        {
          id: 2,
          text: "I'm doing great! Just working on this new chat UI.",
          incoming: false,
          time: "10:32 AM",
          type: "text",
        },
        {
          id: 3,
          text: "Check out this cool photo I took!",
          incoming: true,
          time: "10:35 AM",
          type: "image",
          url: "https://source.unsplash.com/random/300x200?nature",
        },
        {
          id: 4,
          text: "That's amazing! Where was this taken?",
          incoming: false,
          time: "10:36 AM",
          type: "text",
        },
        {
          id: 5,
          text: "Check out this video from my trip!",
          incoming: true,
          time: "10:37 AM",
          type: "video",
          url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
        },
      ],
      2: [
        {
          id: 1,
          text: "Hi Alice! How's your day going?",
          incoming: false,
          time: "9:15 AM",
          type: "text",
        },
        {
          id: 2,
          text: "Going well! Can we meet tomorrow?",
          incoming: true,
          time: "9:20 AM",
          type: "text",
        },
      ],
      3: [
        {
          id: 1,
          text: "Files sent successfully!",
          incoming: true,
          time: "Yesterday",
          type: "text",
        },
        {
          id: 2,
          text: "Thanks! Got them.",
          incoming: false,
          time: "Yesterday",
          type: "text",
        },
      ],
      4: [
        {
          id: 1,
          text: "Thanks for your help with the project!",
          incoming: true,
          time: "2 hours ago",
          type: "text",
        },
        {
          id: 2,
          text: "You're welcome! Anytime.",
          incoming: false,
          time: "1 hour ago",
          type: "text",
        },
      ],
      5: [
        {
          id: 1,
          text: "Meeting scheduled for 3 PM",
          incoming: true,
          time: "Mon",
          type: "text",
        },
        {
          id: 2,
          text: "Don't forget to bring the reports",
          incoming: false,
          time: "Mon",
          type: "text",
        },
      ],
    };

    // Current State
    let currentUserId = null;
    let currentUser = null;
    let isMobile = window.innerWidth < 768;

    // DOM Elements
    const elements = {
      contactsList: document.getElementById("contacts-list"),
      chatMessages: document.getElementById("chat-messages"),
      noChatSelected: document.getElementById("no-chat-selected"),
      currentUserName: document.getElementById("current-user-name"),
      currentUserAvatar: document.getElementById("current-user-avatar"),
      currentUserStatus: document.getElementById("current-user-status"),
      messageInput: document.getElementById("message-input"),
      sendButton: document.getElementById("send-button"),
      contactsSidebar: document.getElementById("contacts-sidebar"),
      chatContainer: document.getElementById("chat-container"),
      overlay: document.getElementById("overlay"),
      menuDropdown: document.getElementById("menu-dropdown"),
      themeToggle: document.getElementById("themeToggle"),
      searchContacts: document.getElementById("searchContacts"),
      body: document.body,
      sunIcon: document.getElementById("sun-icon"),
      moonIcon: document.getElementById("moon-icon"),
    };

    // Initialize App
    function initApp() {
      loadContacts();
      setupEventListeners();
      setupTheme();
      checkMobile();

      // Auto-select first user on desktop
      if (!isMobile && users.length > 0) {
        selectUser(users[0].id);
      }
    }

    // Setup Event Listeners
    function setupEventListeners() {
      // Message input
      elements.messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && currentUserId) {
          sendMessage();
        }
      });

      // Theme toggle
      elements.themeToggle.addEventListener("change", toggleTheme);

      // Search contacts
      elements.searchContacts.addEventListener("input", searchContacts);

      // Window resize
      window.addEventListener("resize", checkMobile);

      // Close menu when clicking outside
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".relative") && !e.target.closest("#menu-dropdown")) {
          elements.menuDropdown.classList.add("hidden");
        }
      });
    }

    // Load Contacts
    function loadContacts() {
      elements.contactsList.innerHTML = "";

      users.forEach((user) => {
        const contactItem = createContactElement(user);
        elements.contactsList.appendChild(contactItem);
      });
    }

    // Create Contact Element
    function createContactElement(user) {
      const div = document.createElement("div");
      div.className = `contact-item flex items-center p-4 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer transition-all mb-2 user-selection ${currentUserId === user.id ? "active-user" : ""
        }`;
      div.onclick = () => selectUser(user.id);

      div.innerHTML = `
        <div class="relative">
          <div class="avatar avatar-medium rounded-full ${user.color}">
            ${user.avatar}
          </div>
          <div class="status-${user.status}"></div>
        </div>
        <div class="flex-1 ml-4">
          <div class="flex justify-between items-center">
            <h3 class="font-semibold">${user.name}</h3>
            <span class="text-xs text-gray-500 dark:text-gray-400">${user.lastSeen
        }</span>
          </div>
          <p class="text-sm text-gray-500 dark:text-gray-400 truncate">${user.lastMessage
        }</p>
        </div>
        ${user.unread > 0
          ? `
          <div class="unread-badge ml-3">
            ${user.unread}
          </div>
        `
          : ""
        }
      `;

      return div;
    }

    // Select User
    function selectUser(userId) {
      currentUserId = userId;
      currentUser = users.find((u) => u.id === userId);

      // Update UI
      updateActiveContact();
      loadChatMessages();
      enableMessageInput();

      // On mobile, hide sidebar after selection
      if (isMobile) {
        closeSidebar();
      }

      // Scroll to top of chat
      elements.chatMessages.scrollTop = 0;
    }

    // Update Active Contact
    function updateActiveContact() {
      if (!currentUser) return;

      // Update header
      elements.currentUserName.textContent = currentUser.name;
      elements.currentUserAvatar.textContent = currentUser.avatar;
      elements.currentUserStatus.textContent =
        currentUser.status.charAt(0).toUpperCase() + currentUser.status.slice(1);

      // Update contacts list
      document.querySelectorAll(".contact-item").forEach((item) => {
        item.classList.remove("active-user");
      });

      const activeContact = document.querySelector(
        `.contact-item:nth-child(${users.findIndex((u) => u.id === currentUserId) + 1
        })`
      );
      if (activeContact) {
        activeContact.classList.add("active-user");
      }
    }

    // Load Chat Messages
    function loadChatMessages() {
      elements.noChatSelected.style.display = "none";
      elements.chatMessages.innerHTML = "";

      // Add date divider
      const dateDivider = document.createElement("div");
      dateDivider.className = "date-divider";
      dateDivider.innerHTML = "<span>Today</span>";
      elements.chatMessages.appendChild(dateDivider);

      // Load messages for current user
      const messages = chatMessages[currentUserId] || [];

      messages.forEach((message) => {
        const messageElement = createMessageElement(message);
        elements.chatMessages.appendChild(messageElement);
      });

      // Add typing indicator for new chats
      if (messages.length === 0) {
        addTypingIndicator();
      }

      // Scroll to bottom
      setTimeout(() => {
        elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
      }, 100);
    }

    // Create Message Element
    function createMessageElement(message) {
      const div = document.createElement("div");
      div.className = `flex mb-6 ${message.incoming ? "" : "justify-end"} message`;

      if (message.type === "text") {
        div.innerHTML = `
          ${message.incoming
            ? `
            <div class="flex-shrink-0 mr-3">
              <div class="avatar avatar-small rounded-full ${currentUser.color}">
                ${currentUser.avatar}
              </div>
            </div>
          `
            : ""
          }
          <div class="flex flex-col ${message.incoming ? "items-start" : "items-end"
          } max-w-[80%]">
            <div class="${message.incoming ? "incoming-message" : "outgoing-message"
          } px-5 py-3">
              ${message.text}
            </div>
            <span class="message-time">${message.time}</span>
          </div>
        `;
      } else if (message.type === "image") {
        div.innerHTML = `
          ${message.incoming
            ? `
            <div class="flex-shrink-0 mr-3">
              <div class="avatar avatar-small rounded-full ${currentUser.color}">
                ${currentUser.avatar}
              </div>
            </div>
          `
            : ""
          }
          <div class="flex flex-col ${message.incoming ? "items-start" : "items-end"
          } max-w-[70%]">
            <div class="${message.incoming ? "incoming-message" : "outgoing-message"
          } p-2">
              <img src="${message.url
          }" alt="Shared image" class="rounded-lg max-w-full h-auto">
            </div>
            <span class="message-time">${message.time}</span>
          </div>
        `;
      } else if (message.type === "video") {
        div.innerHTML = `
          ${message.incoming
            ? `
            <div class="flex-shrink-0 mr-3">
              <div class="avatar avatar-small rounded-full ${currentUser.color}">
                ${currentUser.avatar}
              </div>
            </div>
          `
            : ""
          }
          <div class="flex flex-col ${message.incoming ? "items-start" : "items-end"
          } max-w-[70%]">
            <div class="${message.incoming ? "incoming-message" : "outgoing-message"
          } p-2">
              <div class="video-container">
                <video class="video-player" controls>
                  <source src="${message.url}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              </div>
            </div>
            <span class="message-time">${message.time}</span>
          </div>
        `;
      }

      return div;
    }

    // Send Message
    function sendMessage() {
      const text = elements.messageInput.value.trim();
      if (!text || !currentUserId) return;

      // Create message object
      const message = {
        id: Date.now(),
        text: text,
        incoming: false,
        time: getCurrentTime(),
        type: "text",
      };

      // Add to chat
      const messageElement = createMessageElement(message);
      elements.chatMessages.appendChild(messageElement);

      // Clear input
      elements.messageInput.value = "";

      // Scroll to bottom
      elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

      // Simulate reply after delay
      setTimeout(() => {
        addTypingIndicator();

        setTimeout(() => {
          removeTypingIndicator();

          const reply = {
            id: Date.now() + 1,
            text: "Thanks for your message! I'll reply soon.",
            incoming: true,
            time: getCurrentTime(),
            type: "text",
          };

          const replyElement = createMessageElement(reply);
          elements.chatMessages.appendChild(replyElement);
          elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
        }, 1500);
      }, 1000);
    }

    // Add Typing Indicator
    function addTypingIndicator() {
      const typingDiv = document.createElement("div");
      typingDiv.id = "typing-indicator";
      typingDiv.className = "flex mb-6";
      typingDiv.innerHTML = `
        <div class="flex-shrink-0 mr-3">
          <div class="avatar avatar-small rounded-full ${currentUser.color}">
            ${currentUser.avatar}
          </div>
        </div>
        <div class="incoming-message px-5 py-3">
          <div class="typing-indicator flex space-x-1">
            <div class="w-2 h-2 bg-gray-400 rounded-full" style="animation-delay: 0.1s"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full" style="animation-delay: 0.2s"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full" style="animation-delay: 0.3s"></div>
          </div>
        </div>
      `;
      elements.chatMessages.appendChild(typingDiv);
      elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
    }

    // Remove Typing Indicator
    function removeTypingIndicator() {
      const typingIndicator = document.getElementById("typing-indicator");
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }

    // Enable Message Input
    function enableMessageInput() {
      elements.messageInput.disabled = false;
      elements.messageInput.placeholder = "Type a message...";
      elements.sendButton.disabled = false;
    }

    // Get Current Time
    function getCurrentTime() {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, "0");
      const ampm = hours >= 12 ? "PM" : "AM";
      hours = hours % 12;
      hours = hours ? hours : 12;
      return `${hours}:${minutes} ${ampm}`;
    }

    // Sidebar Functions
    function toggleSidebar() {
      if (isMobile) {
        elements.contactsSidebar.classList.toggle("mobile-active");
        elements.overlay.classList.toggle("active");
        document.body.style.overflow = elements.overlay.classList.contains("active")
          ? "hidden"
          : "auto";
      }
    }

    function closeSidebar() {
      if (isMobile) {
        elements.contactsSidebar.classList.remove("mobile-active");
        elements.overlay.classList.remove("active");
        document.body.style.overflow = "auto";
      }
    }

    function backToContacts() {
      if (isMobile) {
        openSidebar();
      }
    }

    function openSidebar() {
      if (isMobile) {
        elements.contactsSidebar.classList.add("mobile-active");
        elements.overlay.classList.add("active");
        document.body.style.overflow = "hidden";
      }
    }

    // Menu Functions
    function toggleMenu() {
      elements.menuDropdown.classList.toggle("hidden");
    }

    // Theme Functions - FIXED
    function setupTheme() {
      const savedTheme = localStorage.getItem("chat-theme") || "light";
      if (savedTheme === "dark") {
        elements.body.classList.add("dark-mode");
        elements.themeToggle.checked = true;
        updateThemeIcons(true);
      } else {
        elements.body.classList.remove("dark-mode");
        elements.themeToggle.checked = false;
        updateThemeIcons(false);
      }

      // Apply dark mode classes to all elements that need them
      applyDarkModeClasses();
    }

    function toggleTheme() {
      const isDark = !elements.body.classList.contains("dark-mode");

      if (isDark) {
        elements.body.classList.add("dark-mode");
        localStorage.setItem("chat-theme", "dark");
      } else {
        elements.body.classList.remove("dark-mode");
        localStorage.setItem("chat-theme", "light");
      }

      updateThemeIcons(isDark);
      applyDarkModeClasses();
    }

    function updateThemeIcons(isDark) {
      if (isDark) {
        elements.sunIcon.style.opacity = "0.5";
        elements.moonIcon.style.opacity = "1";
      } else {
        elements.sunIcon.style.opacity = "1";
        elements.moonIcon.style.opacity = "0.5";
      }
    }

    function applyDarkModeClasses() {
      // This function ensures dark mode classes are properly applied
      const isDark = elements.body.classList.contains("dark-mode");
      const allElements = document.querySelectorAll("*");

      // Update CSS variables
      document.documentElement.style.setProperty(
        "--bg-light",
        isDark ? "#0f172a" : "#ffffff"
      );
      document.documentElement.style.setProperty(
        "--text-primary",
        isDark ? "#f1f5f9" : "#1e293b"
      );
      document.documentElement.style.setProperty(
        "--text-secondary",
        isDark ? "#cbd5e1" : "#64748b"
      );
      document.documentElement.style.setProperty(
        "--border-light",
        isDark ? "#334155" : "#e2e8f0"
      );
      document.documentElement.style.setProperty(
        "--secondary",
        isDark ? "#1e293b" : "#f8fafc"
      );
    }

    // Check Mobile
    function checkMobile() {
      isMobile = window.innerWidth < 768;

      if (!isMobile) {
        closeSidebar();
        elements.contactsSidebar.style.transform = "translateX(0)";
      } else {
        elements.contactsSidebar.style.transform = "translateX(-100%)";
      }
    }

    // Search Contacts
    function searchContacts() {
      const searchTerm = elements.searchContacts.value.toLowerCase();

      users.forEach((user, index) => {
        const contactItem = elements.contactsList.children[index];
        const userName = user.name.toLowerCase();
        const userMessage = user.lastMessage.toLowerCase();

        if (userName.includes(searchTerm) || userMessage.includes(searchTerm)) {
          contactItem.style.display = "flex";
        } else {
          contactItem.style.display = "none";
        }
      });
    }

    // Action Functions
    function startCall() {
      alert(
        `Starting audio call with ${currentUser?.name || "selected contact"}...`
      );
    }

    function startVideoCall() {
      alert(
        `Starting video call with ${currentUser?.name || "selected contact"}...`
      );
    }

    function viewProfile() {
      alert(`Viewing profile of ${currentUser?.name || "selected contact"}...`);
      toggleMenu();
    }

    function muteNotifications() {
      alert("Notifications muted");
      toggleMenu();
    }

    function clearChat() {
      if (confirm("Are you sure you want to clear this chat?")) {
        elements.chatMessages.innerHTML = "";
        alert("Chat cleared");
      }
      toggleMenu();
    }

    function exportChat() {
      alert("Chat exported as PDF");
      toggleMenu();
    }

    function newChat() {
      alert("New chat modal opened");
    }

    function showSettings() {
      alert("Settings modal opened");
    }

    // Initialize app when DOM is loaded
    document.addEventListener("DOMContentLoaded", initApp);

  </script>
</body>

</html>