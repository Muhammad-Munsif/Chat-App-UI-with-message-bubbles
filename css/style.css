<style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Inter", -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    :root {
      --primary: #7c3aed;
      --primary-dark: #6d28d9;
      --primary-light: #8b5cf6;
      --primary-gradient: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
      --secondary-bg: #f8fafc;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --border-light: #e2e8f0;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow-sm: 0 1px 3px 0 rgba(0,0,0,0.05);
      --shadow-md: 0 6px 12px -8px rgba(0,0,0,0.15);
      --shadow-lg: 0 20px 25px -12px rgba(0,0,0,0.2);
      --radius-message: 20px;
      --transition: all 0.2s ease;
    }

    [data-theme="dark"] {
      --primary: #8b5cf6;
      --primary-dark: #7c3aed;
      --primary-light: #a78bfa;
      --primary-gradient: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
      --secondary-bg: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --border-light: #334155;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: var(--transition);
      height: 100vh;
      overflow: hidden;
    }

    /* main flex container */
    .app-layout {
      display: flex;
      height: 100vh;
      max-width: 1600px;
      margin: 0 auto;
      background: var(--bg-primary);
    }

    /* ===== SIDEBAR (modern card + improved touch) ===== */
    .sidebar {
      width: 360px;
      min-width: 280px;
      background: var(--bg-primary);
      border-right: 1px solid var(--border-light);
      display: flex;
      flex-direction: column;
      transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s;
      z-index: 50;
      position: relative;
    }
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: 85%;
        max-width: 340px;
        transform: translateX(-100%);
        box-shadow: var(--shadow-lg);
        border-right: none;
      }
      .sidebar.active {
        transform: translateX(0);
      }
    }

    /* chat area */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--bg-primary);
      min-width: 0;  /* prevent flex overflow */
    }

    /* avatar rings & badges */
    .avatar {
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      background: var(--primary-gradient);
      color: white;
      position: relative;
      border-radius: 18px;
      transition: var(--transition);
    }
    .avatar-sm { width: 44px; height: 44px; font-size: 1.2rem; border-radius: 14px; }
    .avatar-md { width: 56px; height: 56px; font-size: 1.5rem; border-radius: 18px; }
    .status-dot {
      position: absolute;
      bottom: 2px; right: 2px;
      width: 12px; height: 12px;
      border-radius: 20px;
      border: 2px solid var(--bg-primary);
    }
    .online { background: var(--success); }
    .away { background: var(--warning); }
    .offline { background: var(--text-secondary); }
    .dnd { background: var(--danger); }

    /* conversation item */
    .conversation-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      margin: 4px 12px;
      border-radius: 24px;
      transition: background 0.2s, transform 0.1s;
      cursor: pointer;
    }
    .conversation-item:hover { background: var(--bg-tertiary); }
    .conversation-item.active {
      background: var(--bg-tertiary);
      box-shadow: inset 0 0 0 2px var(--primary-light);
    }
    /* online friends horizontal */
    .online-strip {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 8px 16px;
      scrollbar-width: thin;
      scrollbar-color: var(--text-secondary) transparent;
    }
    .online-strip::-webkit-scrollbar { height: 4px; }
    .online-strip::-webkit-scrollbar-thumb { background: var(--text-secondary); border-radius: 8px; }

    /* messages container */
    .messages-panel {
      flex: 1;
      overflow-y: auto;
      padding: 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }
    .message-row {
      display: flex;
      margin-bottom: 8px;
      animation: fadeIn 0.2s;
    }
    .message-row.justify-end { justify-content: flex-end; }

    .bubble {
      max-width: 75%;
      padding: 12px 18px;
      border-radius: 24px;
      font-size: 0.95rem;
      line-height: 1.4;
      word-wrap: break-word;
      box-shadow: var(--shadow-sm);
      position: relative;
    }
    .incoming-bubble {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-bottom-left-radius: 6px;
    }
    .outgoing-bubble {
      background: var(--primary-gradient);
      color: white;
      border-bottom-right-radius: 6px;
    }
    .message-time {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }
    .reaction-badge {
      position: absolute;
      bottom: -10px; right: 10px;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: 30px;
      padding: 2px 8px;
      font-size: 0.75rem;
      display: flex;
      gap: 4px;
      box-shadow: var(--shadow-sm);
    }

    /* date divider */
    .date-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 16px 0;
    }
    .date-divider span {
      background: var(--bg-secondary);
      padding: 6px 18px;
      border-radius: 40px;
      font-size: 0.8rem;
      color: var(--text-secondary);
      border: 1px solid var(--border-light);
      font-weight: 500;
    }

    /* typing indicator */
    .typing {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 12px 20px;
      background: var(--bg-tertiary);
      border-radius: 30px;
      width: fit-content;
    }
    .typing span {
      width: 8px; height: 8px;
      background: var(--text-secondary);
      border-radius: 50%;
      animation: pulseTyping 1.4s infinite;
    }
    .typing span:nth-child(2) { animation-delay: 0.2s; }
    .typing span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes pulseTyping { 0%,60%,100%{ opacity:0.4; transform: translateY(0); } 30%{ opacity:1; transform: translateY(-4px); } }

    @keyframes fadeIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

    /* input area */
    .input-footer {
      background: var(--bg-primary);
      border-top: 1px solid var(--border-light);
      padding: 12px 16px;
    }
    .message-input-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-secondary);
      border-radius: 40px;
      padding: 4px 4px 4px 18px;
      border: 1px solid transparent;
      transition: border 0.15s;
    }
    .message-input-wrapper:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(124,58,237,0.15);
    }
    .message-input {
      flex: 1;
      background: transparent;
      border: 0;
      padding: 12px 0;
      font-size: 0.95rem;
      color: var(--text-primary);
      outline: none;
    }
    .attach-btn, .send-btn {
      width: 44px; height: 44px;
      border-radius: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      color: var(--text-secondary);
      transition: var(--transition);
      cursor: pointer;
    }
    .send-btn {
      background: var(--primary-gradient);
      color: white;
      box-shadow: var(--shadow-sm);
    }
    .send-btn:disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* attachment popup menu */
    .attach-popup {
      position: absolute;
      bottom: 80px; left: 16px;
      background: var(--bg-primary);
      border-radius: 30px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-light);
      padding: 12px 20px;
      display: flex;
      gap: 24px;
      z-index: 30;
      backdrop-filter: blur(12px);
    }
    .attach-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .attach-option i { font-size: 1.4rem; color: var(--primary); }
    .attach-option:hover { transform: scale(1.05); color: var(--primary); }

    /* floating new chat (mobile) */
    .fab-mobile {
      position: fixed;
      bottom: 24px; right: 24px;
      width: 56px; height: 56px;
      border-radius: 30px;
      background: var(--primary-gradient);
      color: white;
      display: flex; align-items: center; justify-content: center;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      transition: 0.2s;
      z-index: 45;
      opacity: 0; visibility: hidden;
    }
    @media (max-width: 768px) {
      .fab-mobile {
        opacity: 1; visibility: visible;
      }
    }

    /* overlay */
    .mobile-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(4px);
      z-index: 45;
      opacity: 0; visibility: hidden;
      transition: 0.2s;
    }
    .mobile-overlay.active {
      opacity: 1; visibility: visible;
    }

    /* utility: hide on mobile/desktop */
    .hide-md-down { display: flex; }
    @media (max-width: 768px) { .hide-md-down { display: none; } }

    /* improved touch targets */
    button, .clickable { cursor: pointer; min-width: 44px; min-height: 44px; }
  </style>